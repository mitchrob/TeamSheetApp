{% extends 'base.html' %}
{% block title %}Add Teamsheet{% endblock %}
{% block content %}
<h1>Add Teamsheet</h1>
{# flashes shown in base.html #}

<form method="post" action="{{ url_for('admin.add_post') }}">
  <div>
    <label>League: <input name="league" value="{{ defaults.league }}" /></label>
    <label>Season: <input name="season" value="{{ defaults.season }}" /></label>
    <label>Date: <input name="date" value="{{ defaults.date }}" /></label>
    <label>Opposition: <input name="opposition" value="{{ defaults.opposition }}" /></label>
    <label>Location: <input name="location" value="{{ defaults.location }}" /></label>
    <label>Result: <input name="result" value="{{ defaults.result }}" /></label>
    <label>Guildford Points: <input name="guildford_points" value="{{ defaults.guildford_points }}" /></label>
    <label>Opposition Points: <input name="opposition_points" value="{{ defaults.opposition_points }}" /></label>
  </div>

  <h3>Players</h3>
  <div class="players">
    <datalist id="playerNames"></datalist>
    {% for i in range(1,21) %}
    <label>Player {{ i }}: <input name="player{{ i }}" list="playerNames" size="40" value="{{ defaults.players[i-1] }}"
        autocomplete="off" /></label>
    {% endfor %}
  </div>
  <script>
    (function () {
      // Fetch existing player names and populate the datalist for browser-native suggestions.
      // This runs only on the add page. The endpoint is admin-protected.
      function populate() {
        fetch(window.location.origin + '/player_names')
          .then(r => { if (!r.ok) throw new Error('Failed to fetch'); return r.json(); })
          .then(names => {
            const dl = document.getElementById('playerNames');
            if (!dl) return;
            // Clear existing
            dl.innerHTML = '';
            names.forEach(n => {
              if (n && typeof n === 'string') {
                const opt = document.createElement('option');
                opt.value = n;
                dl.appendChild(opt);
              }
            });
          })
          .catch(err => {
            // non-fatal; silently ignore so admin form still works
            console.debug('player_names fetch error', err);
          });
      }
      // Populate on load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', populate);
      } else {
        populate();
      }
    })();
  </script>
  <div class="form-actions">
    <button type="submit" class="btn">Add teamsheet</button>
  </div>
</form>

{# navigation links are in the header ribbon; removed redundant links here #}
{% endblock %}