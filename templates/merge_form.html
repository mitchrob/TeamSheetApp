{% extends 'base.html' %}
{% block title %}Merge Players{% endblock %}
{% block content %}
  <h1>Merge Duplicate Players</h1>
  <p>Select the players you want to merge and choose the single correct name to keep. All appearances from the other selected names will be reassigned to the correct name, and the incorrect player records will be deleted.</p>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Merging Group</h5>
      <form method="POST" action="{{ url_for('merge_players') }}">
        <div class="mb-3">
          <p><strong>1. Select players to merge:</strong></p>
          {% for player in players %}
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="names_to_merge" value="{{ player.name }}" id="check-{{ player.id }}" checked>
              <label class="form-check-label" for="check-{{ player.id }}">
                {{ player.name }} ({{ player.appearances.count() }} appearances)
              </label>
            </div>
          {% endfor %}
        </div>

        <div class="mb-3">
          <p><strong>2. Choose the correct name to keep:</strong></p>
          {% for player in players %}
            <div class="form-check">
              <input class="form-check-input" type="radio" name="canonical_name" value="{{ player.name }}" id="radio-{{ player.id }}" {% if loop.first %}checked{% endif %}>
              <label class="form-check-label" for="radio-{{ player.id }}">{{ player.name }}</label>
            </div>
          {% endfor %}
        </div>
        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to merge these players? This action cannot be undone.');">Merge Selected Players</button>
        <a href="{{ url_for('view_duplicates') }}" class="btn btn-secondary">Cancel</a>
      </form>
    </div>
  </div>
{% endblock %}