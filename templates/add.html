{% extends 'base.html' %}
{% block title %}Add Teamsheet{% endblock %}
{% block content %}
  <h1>Add Teamsheet</h1>
  {# flashes shown in base.html #}

  <form method="post" action="{{ url_for('add_post') }}" class="needs-validation" novalidate>
    <h4>Match Details</h4>
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <label for="league" class="form-label">League</label>
        <input type="text" class="form-control" id="league" name="league" value="{{ defaults.league }}">
      </div>
      <div class="col-md-4">
        <label for="season" class="form-label">Season</label>
        <input type="text" class="form-control" id="season" name="season" value="{{ defaults.season }}">
      </div>
      <div class="col-md-4">
        <label for="date" class="form-label">Date</label>
        <input type="text" class="form-control" id="date" name="date" placeholder="dd/mm/yyyy" value="{{ defaults.date }}">
      </div>
      <div class="col-md-6">
        <label for="opposition" class="form-label">Opposition</label>
        <input type="text" class="form-control" id="opposition" name="opposition" value="{{ defaults.opposition }}">
      </div>
      <div class="col-md-6">
        <label for="location" class="form-label">Location</label>
        <input type="text" class="form-control" id="location" name="location" value="{{ defaults.location }}">
      </div>
      <div class="col-md-4">
        <label for="result" class="form-label">Result</label>
        <input type="text" class="form-control" id="result" name="result" value="{{ defaults.result }}">
      </div>
      <div class="col-md-4">
        <label for="guildford_points" class="form-label">Guildford Points</label>
        <input type="number" class="form-control" id="guildford_points" name="guildford_points" value="{{ defaults.guildford_points }}">
      </div>
      <div class="col-md-4">
        <label for="opposition_points" class="form-label">Opposition Points</label>
        <input type="number" class="form-control" id="opposition_points" name="opposition_points" value="{{ defaults.opposition_points }}">
      </div>
    </div>

    <hr class="my-4">
    <h4>Players</h4>
    <div class="players">
      <datalist id="playerNames"></datalist>
      {% for i in range(1,21) %}
        <div class="mb-2">
          <label for="player{{ i }}" class="form-label">Player {{ i }}</label>
          <input type="text" class="form-control" id="player{{ i }}" name="player{{ i }}" list="playerNames" value="{{ defaults.players[i-1] }}" autocomplete="off">
        </div>
      {% endfor %}
    </div>
    <script>
      (function(){
        // Fetch existing player names and populate the datalist for browser-native suggestions.
        // This runs only on the add page. The endpoint is admin-protected.
        function populate() {
          fetch(window.location.origin + '/player_names')
            .then(r => { if (!r.ok) throw new Error('Failed to fetch'); return r.json(); })
            .then(names => {
              const dl = document.getElementById('playerNames');
              if (!dl) return;
              // Clear existing
              dl.innerHTML = '';
              names.forEach(n => {
                if (n && typeof n === 'string') {
                  const opt = document.createElement('option');
                  opt.value = n;
                  dl.appendChild(opt);
                }
              });
            })
            .catch(err => {
              // non-fatal; silently ignore so admin form still works
              console.debug('player_names fetch error', err);
            });
        }
        // Populate on load
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', populate);
        } else {
          populate();
        }
      })();
    </script>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary btn-lg">Add Teamsheet</button>
    </div>
  </form>

  {# navigation links are in the header ribbon; removed redundant links here #}
{% endblock %}
